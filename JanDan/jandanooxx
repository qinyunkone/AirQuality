import requests
from bs4 import BeautifulSoup
import lxml
import time
import os


def ooxx(pages=2):
    folder = 'OOXX'
    os.mkdir(folder)
    os.chdir(folder)

    url = 'http://jandan.net/ooxx/'
    time.sleep(1)
    req = requests.get(url).text
    soup = BeautifulSoup(req, 'lxml')

    pages_num = int(soup.find('span', class_='current-comment-page').text[1:-1])

    for i in range(pages):
        pages_num -= i
        page_url = url + 'page-' + str(pages_num) + '#comments'
        time.sleep(1)
        page_req = requests.get(page_url).text
        page_soup = BeautifulSoup(page_req, 'lxml')
        
        for j in page_soup.find_all('img'):
            img_addrs = 'http:' + j.attrs['src']
            filename = img_addrs.split('/')[-1]

            with open(filename, 'wb') as f:
                time.sleep(1)
                img = requests.get(img_addrs).content
                f.write(img)


if __name__ == '__main__':
    ooxx()
